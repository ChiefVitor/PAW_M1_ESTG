<%- include ('../partials/_header.ejs') %>
  <nav class="navbar navbar-light bg-light">
    <span class="navbar-brand mb-0 lead">

      Loja PAW</span>
    <span>
      <a href="/books" class="btn btn-sm btn-success">Voltar a Loja</a>
      <a href="/users/orders" class="btn btn-sm btn-info">Pedidos</a>
      <a href="/users/logout" class="btn btn-sm btn-warning">Log Out</a>
    </span>
  </nav>
  <div class="container">
    <div class="jumbotron my-2">
      <div class="container container-fluid text-center">
        <h1 class="display-4">Welcome <strong class="capital">
            <%= user.name %>
          </strong></h1>
        <hr class="my-2">
        <p class="lead">
          Aqui é a sua Dashboard
        </p>
        <h5>
          <span style="color: rgb(97, 91, 92);">email:</span> <span>
            <%= user.email %>
          </span>
        </h5>
      </div>
    </div>
    <div class="jumbotron p-3">
      <div class="d-flex justify-content-around" style="font-size: 25px; color: darkblue;">
        <span>Seu Carrinho <%= user.carts.length===0 ? 'is empty' : '' %></span>
        <% if(user.carts.length !==0) {%>
          <button type="button" class="lead btn btn-warning" data-toggle="modal" data-target="#exampleModalCenter">
            Checkout
          </button>
          <% } %>
      </div>
      <div class="container mt-2">
        <table class="table table-bordered bg-light table-responsive-sm">
          <thead>
            <tr>
              <th scope="col">Capa</th>
              <th scope="col">Title</th>
              <th scope="col">Price</th>
              <th scope="col">Action</th>
            </tr>
          </thead>
          <tbody>
            <% user.carts.forEach(cartItem=>{ %>
              <tr>
                <td><img src="<%= cartItem.book.image  %>" alt="Book Capa" class="img-thumbnail"
                    style="height: 8rem; width: 8rem;"></td>
                <td class="lead text-primary">
                  <%= cartItem.book.title %>
                </td>
                <td class="lead text-danger">€<%= cartItem.book.price %>
                </td>
                <td>
                  <form action="/users/cart/<%= cartItem.book._id  %>/delete?_method=DELETE" class="d-inline"
                    method="POST">
                    <button type="submit" class="btn btn-sm btn-danger">Remove</button>
                  </form>
                </td>
              </tr>
              <% }) %>
          </tbody>
        </table>
      </div>
    </div>
    <% if(user.carts.length !==0) {%>
      <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalCenterTitle">Definir Quantidade de livros</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <form method="POST" action="/users/checkout">
              <div class="modal-body">
                <div class="container mt-2">
                  <table class="table table-bordered bg-light table-responsive-sm">
                    <thead>
                      <tr>
                        <th scope="col">Titulo</th>
                        <th scope="col">Preço</th>
                        <th scope="col">Quantidade</th>
                      </tr>

                    </thead>
                    <tbody>
                      <% user.carts.forEach(cartItem=>{ %>
                        <tr>
                          <td class="lead text-primary">
                            <%= cartItem.book.title %>
                          </td>
                          <td class="lead text-danger">
                            <%= cartItem.book.price %> €
                          </td>
                          <td>
                            <select name="<%= cartItem.book._id %>" class="form-control">
                              <% if (cartItem.book.stock <= 10) { %>
                                <option selected>1</option>
                                <%} else { %>
                                  <% for(let i=1; i <=10 ; i++){ %>
                                    <% if(cartItem.quantity===i){ %>
                                      <option selected>
                                        <%= i %>
                                      </option>
                                      <% }else{ %>
                                        <option>
                                          <%= i %>
                                        </option>
                                        <% } %>
                                          <% } %>
                                            <% } %>
                            </select>
                          </td>
                        </tr>

                        <% }) %>
                    </tbody>

                  </table>
                  <% if (user.points >= 5) { %>
                    <div class="form-check">
                      <input class="form-check-input" type="radio" name="shippingmethod" id="exampleRadios1" value="free" checked>
                      <label class="form-check-label" for="exampleRadios1">
                        Expedição Gratis - Usar 5 Pontos
                      </label>
                    </div>
                    <%} else { %>
                      <div class="form-check">
                        <input class="form-check-input" type="radio" name="shippingmethod" id="exampleRadios1" value="free" disabled>
                        <label class="form-check-label" for="exampleRadios1">
                          Expedição Gratis - Usar 5 Pontos
                        </label>
                      </div>
                    <% } %>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="shippingmethod" id="exampleRadios2" value="paid">
                    <label class="form-check-label" for="exampleRadios2">
                      Expedição Paga - 5€
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="shippingmethod" id="exampleRadios3" value="pickup">
                    <label class="form-check-label" for="exampleRadios3">
                      Levantamento em Loja
                    </label>
                  </div>

                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                <button type="submit" class="btn btn-primary">Confirmar Compra</button>
              </div>
            </form>
          </div>
        </div>
      </div>
      <% } %>
  </div>

  <%- include ('../partials/_footer.ejs') %>